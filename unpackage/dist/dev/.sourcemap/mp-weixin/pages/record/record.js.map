{"version":3,"file":"record.js","sources":["pages/record/record.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcmVjb3JkL3JlY29yZC52dWU"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <!-- 标题 -->\r\n    <view class=\"title\">声音录制</view>\r\n\r\n    <!-- 时间显示 -->\r\n    <view class=\"time-display\">\r\n      <text class=\"time\">{{ timeDisplay?.h||'00' }}</text>\r\n      <text class=\"colon\">:</text>\r\n      <text class=\"time\">{{ timeDisplay?.m||'00' }}</text>\r\n      <text class=\"colon\">:</text>\r\n      <text class=\"time\">{{ timeDisplay?.s||'00' }}</text>\r\n    </view>\r\n\r\n    <!-- 波形可视化 -->\r\n<!--    <view class=\"visualizer\" v-if=\"state !== 0\">\r\n      <view v-for=\"(bar, index) in visualizerBars\" :key=\"index\" class=\"bar\" :style=\"{ height: bar.height + 'px' }\">\r\n      </view>\r\n    </view> -->\r\n\r\n    <!-- 控制按钮组 -->\r\n    <view class=\"controls\">\r\n      <!-- 播放按钮 -->\r\n      <button class=\"control-btn play-btn\" :class=\"{ disabled: !tempFilePath }\" @tap=\"playRecording\">\r\n        <uni-icons type=\"headphones\" size=\"30\" color=\"blue\"></uni-icons>\r\n      </button>\r\n\r\n      <!-- 主录音按钮 -->\r\n      <view class=\"main-btn\" :class=\"{ recording: state === 1, paused: state === 2 }\" @tap=\"handleRecord\">\r\n        <view class=\"inner-circle\"></view>\r\n      </view>\r\n\r\n      <!-- 停止按钮 -->\r\n      <button class=\"control-btn stop-btn\" :class=\"{ disabled: state === 0 }\" @tap=\"stopRecording\">\r\n        <uni-icons type=\"circle-filled\" size=\"30\" color=\"red\"></uni-icons>\r\n      </button>\r\n    </view>\r\n\r\n    <!-- 状态提示 -->\r\n    <view class=\"status-text\">\r\n      {{ statusMessage }}\r\n    </view>\r\n    <view style=\"display:flex\">\r\n      <button class=\"action-btn\" :disabled=\"!tempFilePath\" @tap=\"uploadFile\">\r\n        <uni-icons type=\"cloud-upload\" size=\"24\" color=\"#666\"></uni-icons>\r\n        <text>云端检测</text>\r\n      </button>\r\n\r\n    </view>\r\n    <view style=\"margin-top: 30rpx;\">\r\n      <text style=\"font-size: 28rpx; color: #2c3e50;\">云端检测伪造概率：<text :style=\"{color: probabilityColor,'font-size':'36rpx'} \">{{result}}%</text></text>\r\n    </view>\r\n    <!-- 添加uniapp进度条 -->\r\n    <view style=\"width: 80%; margin-top: 20rpx;\">\r\n      <progress \r\n        :percent=\"result\" \r\n        stroke-width=\"12px\" \r\n        :activeColor=\"probabilityColor\" \r\n        backgroundColor=\"#e5e5e5\" \r\n        border-radius=\"6px\"\r\n        active \r\n      />\r\n    </view>\r\n  </view>\r\n\r\n\r\n\r\n</template>\r\n<script setup>\r\n  import {\r\n    ref,\r\n    reactive,\r\n    onUnmounted,\r\n    computed\r\n  } from 'vue'\r\n  import {\r\n    onShow,\r\n    onLoad\r\n  } from '@dcloudio/uni-app';\r\n  // 录音管理器\r\n  const tape = uni.getRecorderManager()\r\n  // 音频上下文\r\n  const audio = uni.createInnerAudioContext()\r\n\r\n  // 响应式状态\r\n  const state = ref(0) // 0:停止 1:录音中 2:暂停\r\n  const time = ref(0)\r\n  const tempFilePath = ref(null)\r\n  const timer = ref(null)\r\n  const result = ref(0)\r\n\r\n  // 时间显示\r\n  const timeDisplay = reactive({\r\n    h: '00',\r\n    m: '00',\r\n    s: '00'\r\n  })\r\n  onLoad(() => {\r\n    updateTime()\r\n  })\r\n  // 自动清理定时器\r\n  onUnmounted(() => {\r\n    clearInterval(timer.value)\r\n    audio.destroy()\r\n  })\r\n\r\n  // 格式化时间\r\n  const formatTime = (time) => {\r\n    return time < 10 ? `0${time}` : time\r\n  }\r\n\r\n  // 更新时间显示\r\n  const updateTime = () => {\r\n    if (!timeDisplay) {\r\n      console.error('timeDisplay is undefined')\r\n      return\r\n    }\r\n\r\n    const total = time.value || 0\r\n    timeDisplay.h = formatTime(Math.floor(total / 3600))\r\n    timeDisplay.m = formatTime(Math.floor((total % 3600) / 60))\r\n    timeDisplay.s = formatTime(Math.floor(total % 60))\r\n  }\r\n\r\n  // 开始/暂停录音\r\n  const handleRecord = () => {\r\n    console.log('handleRecord')\r\n    switch (state.value) {\r\n      case 0: // 开始录音\r\n        startRecording()\r\n        break\r\n      case 1: // 暂停录音\r\n        pauseRecording()\r\n        break\r\n      case 2: // 继续录音\r\n        resumeRecording()\r\n        break\r\n    }\r\n  }\r\n\r\n  // 开始录音\r\n  const startRecording = () => {\r\n    state.value = 1\r\n    tape.start()\r\n    startTimer()\r\n\r\n  }\r\n\r\n  // 暂停录音\r\n  const pauseRecording = () => {\r\n    state.value = 2\r\n    clearInterval(timer.value)\r\n    tape.pause()\r\n  }\r\n\r\n  // 继续录音\r\n  const resumeRecording = () => {\r\n    state.value = 1\r\n    tape.resume()\r\n    startTimer()\r\n  }\r\n\r\n  // 停止录音\r\n  const stopRecording = () => {\r\n    state.value = 0\r\n    clearInterval(timer.value)\r\n    tape.stop()\r\n    resetTimer()\r\n    uni.showToast({\r\n      title: '保存成功',\r\n      duration: 1000\r\n    })\r\n  }\r\n\r\n  // 播放录音\r\n  const playRecording = () => {\r\n    if (!tempFilePath.value) {\r\n      uni.showModal({\r\n        title: '提示',\r\n        content: '请先录制音频'\r\n      })\r\n      return\r\n    }\r\n    audio.src = tempFilePath.value\r\n    audio.play()\r\n    startarti.showToast({\r\n      title: '播放中',\r\n      duration: 1000\r\n    })\r\n  }\r\n\r\n  // 定时器逻辑\r\n  const startTimer = () => {\r\n    timer.value = setInterval(() => {\r\n      time.value++\r\n      updateTime()\r\n    }, 1000)\r\n  }\r\n\r\n  // 重置计时器\r\n  const resetTimer = () => {\r\n    time.value = 0\r\n    updateTime()\r\n  }\r\n\r\n  // 录音结束回调\r\n  tape.onStop((res) => {\r\n    tempFilePath.value = res.tempFilePath\r\n  })\r\n\r\n  // 计算按钮文本\r\n  const buttonText = computed(() => {\r\n    return ['开始录音', '暂停录音', '继续录音'][state.value]\r\n  })\r\n\r\n  // 新增可视化数据\r\n  const visualizerBars = ref(\r\n    Array.from({\r\n      length: 15\r\n    }, () => ({\r\n      height: Math.random() * 30 + 10\r\n    }))\r\n  )\r\n\r\n  // 状态提示消息\r\n  const statusMessage = computed(() => {\r\n    return [\r\n      '点击红色按钮开始录音',\r\n      '录音中...',\r\n      '已暂停'\r\n    ][state.value]\r\n  })\r\n\r\n  // 播放状态\r\n  const isPlaying = ref(false)\r\n\r\n  const uploadFile = async () => {\r\n    if (!tempFilePath.value) return\r\n\r\n    uni.showLoading({\r\n      title: '上传中...',\r\n      mask: true\r\n    })\r\n\r\n    try {\r\n      const res = await uni.uploadFile({\r\n        url: 'http://110.41.61.229:3006/common/upload', // 替换为实际接口\r\n        filePath: tempFilePath.value,\r\n        name: 'file',\r\n        formData: {\r\n          'content-type': 'multipart/form-data'\r\n        }\r\n      })\r\n      console.log(res.data)\r\n      const receive = JSON.parse(res.data)\r\n      result.value = Number((parseFloat(receive.probability) * 100).toFixed(2))\r\n      \r\n      // 保存到历史记录\r\n      saveHistory({\r\n        fileName: '录音文件',\r\n        source: '录音上传',\r\n        result: result.value,\r\n        time: new Date().toLocaleString()\r\n      })\r\n\r\n    } catch (error) {\r\n      uni.showModal({\r\n        title: '上传失败',\r\n        content: error.message,\r\n        showCancel: false\r\n      })\r\n    } finally {\r\n      uni.hideLoading()\r\n    }\r\n  }\r\n\r\n  // 保存历史记录\r\n  const saveHistory = (data) => {\r\n    let history = uni.getStorageSync('detectHistory') || []\r\n    history.unshift(data)\r\n    if (history.length > 50) history = history.slice(0, 50)\r\n    uni.setStorageSync('detectHistory', history)\r\n  }\r\n\r\n  // 仿照index的颜色计算逻辑\r\n  const probabilityColor = computed(() => {\r\n    const green = [0, 255, 0];\r\n    const red = [255, 0, 0];\r\n    const r = Math.round(red[0] * (result.value / 100) + green[0] * (1 - result.value / 100));\r\n    const g = Math.round(red[1] * (result.value / 100) + green[1] * (1 - result.value / 100));\r\n    const b = Math.round(red[2] * (result.value / 100) + green[2] * (1 - result.value / 100));\r\n    const hex = (r << 16 | g << 8 | b).toString(16).padStart(6, \"0\");\r\n    return `#${hex}`;\r\n  });\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n  .container {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    height: 100vh;\r\n    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);\r\n    padding: 40rpx;\r\n  }\r\n\r\n  .title {\r\n    font-size: 48rpx;\r\n    color: #2c3e50;\r\n    letter-spacing: 4rpx;\r\n    margin: 60rpx 0;\r\n    font-weight: 500;\r\n  }\r\n\r\n  .time-display {\r\n    display: flex;\r\n    align-items: baseline;\r\n    margin: 40rpx 0;\r\n\r\n    .time {\r\n      font-size: 80rpx;\r\n      color: #2c3e50;\r\n      text-shadow: 2rpx 2rpx 4rpx rgba(0, 0, 0, 0.1);\r\n    }\r\n\r\n    .colon {\r\n      font-size: 60rpx;\r\n      margin: 0 10rpx;\r\n      color: #666;\r\n    }\r\n  }\r\n\r\n  .visualizer {\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: flex-end;\r\n    height: 150rpx;\r\n    margin: 60rpx 0;\r\n    gap: 8rpx;\r\n\r\n    .bar {\r\n      width: 16rpx;\r\n      background: #409EFF;\r\n      border-radius: 8rpx;\r\n      transition: height 0.2s ease;\r\n    }\r\n  }\r\n\r\n  .controls {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 80rpx;\r\n    margin-top: 60rpx;\r\n  }\r\n\r\n  .main-btn {\r\n    width: 160rpx;\r\n    height: 160rpx;\r\n    border-radius: 50%;\r\n    background: #ff4444;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    box-shadow: 0 8rpx 20rpx rgba(255, 68, 68, 0.3);\r\n    transition: all 0.3s ease;\r\n    position: relative;\r\n\r\n    &.recording {\r\n      animation: pulse 1.5s infinite;\r\n\r\n      .inner-circle {\r\n        width: 60rpx;\r\n        height: 60rpx;\r\n        border-radius: 12rpx;\r\n      }\r\n    }\r\n\r\n    &.paused {\r\n      background: #ffa500;\r\n\r\n      .inner-circle {\r\n        width: 0;\r\n        height: 0;\r\n        border-style: solid;\r\n        border-width: 30rpx 0 30rpx 50rpx;\r\n        border-color: transparent transparent transparent #fff;\r\n      }\r\n    }\r\n  }\r\n\r\n  .inner-circle {\r\n    width: 80rpx;\r\n    height: 80rpx;\r\n    background: #fff;\r\n    border-radius: 50%;\r\n    transition: all 0.3s ease;\r\n  }\r\n\r\n  .control-btn {\r\n    width: 100rpx;\r\n    height: 100rpx;\r\n    border-radius: 50%;\r\n    background: #fff;\r\n    box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    transition: all 0.2s ease;\r\n\r\n    &.disabled {\r\n      opacity: 0.5;\r\n      filter: grayscale(1);\r\n    }\r\n\r\n    .icon {\r\n      width: 50rpx;\r\n      height: 50rpx;\r\n    }\r\n  }\r\n\r\n  .status-text {\r\n    margin: 20rpx;\r\n    color: #666;\r\n    font-size: 28rpx;\r\n  }\r\n\r\n  @keyframes pulse {\r\n    0% {\r\n      transform: scale(1);\r\n    }\r\n\r\n    50% {\r\n      transform: scale(1.05);\r\n    }\r\n\r\n    100% {\r\n      transform: scale(1);\r\n    }\r\n  }\r\n\r\n  .action-buttons {\r\n    margin-top: 40rpx;\r\n    display: flex;\r\n    gap: 40rpx;\r\n  }\r\n\r\n  .action-btn {\r\n    border-radius: 50rpx;\r\n    background: #fff;\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 10rpx;\r\n    box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\r\n\r\n    &[disabled] {\r\n      opacity: 0.5;\r\n      filter: grayscale(1);\r\n    }\r\n\r\n    text {\r\n      font-size: 28rpx;\r\n      color: #666;\r\n    }\r\n  }\r\n</style>","import MiniProgramPage from 'E:/program/FrontEnd/uni/detector/pages/record/record.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","ref","reactive","onLoad","onUnmounted","time","computed"],"mappings":"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"}