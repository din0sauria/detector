{"version":3,"file":"history.js","sources":["pages/history/history.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaGlzdG9yeS9oaXN0b3J5LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <view class=\"header\">\r\n      <text class=\"title\">检测历史记录</text>\r\n      <text class=\"subtitle\">最近50条记录</text>\r\n    </view>\r\n    <view class=\"chart\">\r\n      <qiun-data-charts type=\"column\" :chartData=\"columnData\" />\r\n    </view>\r\n    <view class=\"chart\">\r\n      <qiun-data-charts type=\"pie\" :chartData=\"pieData\" />\r\n    </view>\r\n    <scroll-view class=\"history-list\" scroll-y>\r\n      <view v-for=\"(item, index) in historyList\" :key=\"index\" class=\"history-item\"\r\n        :style=\"{ borderLeftColor: getColorByResult(item.result) }\">\r\n        <view class=\"item-header\">\r\n          <text class=\"file-name\">{{ item.fileName }}</text>\r\n          <text class=\"result\" :style=\"{ color: getColorByResult(item.result) }\">\r\n            {{ item.result }}%\r\n          </text>\r\n        </view>\r\n        <view class=\"item-footer\">\r\n          <text class=\"source\">{{ item.source }}</text>\r\n          <text class=\"time\">{{ item.time }}</text>\r\n        </view>\r\n      </view>\r\n    </scroll-view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\nimport { onShow, onReady } from '@dcloudio/uni-app'\r\n\r\nconst historyList = ref([]);\r\n\r\n// 柱状图数据（按官方文档结构）\r\nconst columnData = ref({\r\n  categories: [],\r\n  series: [{\r\n    name: \"检测结果\",\r\n    data: [],\r\n  }],\r\n  xAxis: {\r\n    // 隐藏 x 轴标签\r\n    axisLabel: {\r\n      show: false \r\n    },\r\n    // 隐藏 x 轴刻度线\r\n    axisTick: {\r\n      show: false \r\n    },\r\n    // 隐藏 x 轴轴线\r\n    axisLine: {\r\n      show: false \r\n    }\r\n  }\r\n\r\n});\r\n\r\n// 饼图数据（按官方文档结构）\r\nconst pieData = ref({\r\n  series: [{\r\n    data: [],\r\n    // 饼图颜色配置\r\n    color: (params) => getColorByResult(params.value)\r\n  }]\r\n});\r\n\r\nonShow(() => {\r\n  loadHistory();\r\n});\r\nconst loadHistory = () => {\r\n  historyList.value = uni.getStorageSync('detectHistory') || [];\r\n\r\n  // 更新柱状图数据\r\n  columnData.value = {\r\n    categories: historyList.value.map(item => ' '),\r\n    series: [{\r\n      ...columnData.value.series[0],\r\n      data: historyList.value.map(item => Number(item.result))\r\n    }]\r\n  };\r\n\r\n  // 更新饼图数据（保持分类逻辑）\r\n  const pieCategories = {\r\n    '高风险': { min: 70, max: 100, count: 0 },\r\n    '中风险': { min: 30, max: 69, count: 0 },\r\n    '低风险': { min: 0, max: 29, count: 0 }\r\n  };\r\n\r\n  historyList.value.forEach(item => {\r\n    const result = Number(item.result);\r\n    Object.values(pieCategories).forEach(cat => {\r\n      if (result >= cat.min && result <= cat.max) cat.count++;\r\n    });\r\n  });\r\n\r\n  pieData.value = {\r\n    series: [{\r\n      ...pieData.value.series[0],\r\n      data: Object.entries(pieCategories).map(([name, cat]) => ({\r\n        name,\r\n        value: cat.count\r\n      }))\r\n    }]\r\n  };\r\n};\r\n\r\n\r\n\r\nconst getColorByResult = (result) => {\r\n  const green = [0, 255, 0];\r\n  const red = [255, 0, 0];\r\n  const r = Math.round(red[0] * (result / 100) + green[0] * (1 - result / 100));\r\n  const g = Math.round(red[1] * (result / 100) + green[1] * (1 - result / 100));\r\n  const b = Math.round(red[2] * (result / 100) + green[2] * (1 - result / 100));\r\n  const hex = (r << 16 | g << 8 | b).toString(16).padStart(6, '0');\r\n  return `#${hex}`;\r\n};\r\n\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.container {\r\n  padding: 20rpx;\r\n  height: 100vh;\r\n  background-color: #f5f5f5;\r\n}\r\n\r\n.header {\r\n  padding: 20rpx;\r\n  margin-bottom: 20rpx;\r\n\r\n  .title {\r\n    font-size: 40rpx;\r\n    font-weight: bold;\r\n    display: block;\r\n  }\r\n\r\n  .subtitle {\r\n    font-size: 28rpx;\r\n    color: #666;\r\n  }\r\n}\r\n\r\n.history-list {\r\n  height: calc(100vh - 120rpx);\r\n}\r\n\r\n.history-item {\r\n  background: #fff;\r\n  border-radius: 12rpx;\r\n  padding: 20rpx;\r\n  margin-bottom: 20rpx;\r\n  border-left: 8rpx solid;\r\n\r\n  .item-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    margin-bottom: 10rpx;\r\n\r\n    .file-name {\r\n      font-size: 32rpx;\r\n      max-width: 70%;\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n      white-space: nowrap;\r\n    }\r\n\r\n    .result {\r\n      font-size: 32rpx;\r\n      font-weight: bold;\r\n    }\r\n  }\r\n\r\n  .item-footer {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    font-size: 24rpx;\r\n    color: #999;\r\n  }\r\n}\r\n\r\n.chart {\r\n  width: 100%;\r\n  height: 400rpx;\r\n  padding: 0;\r\n}\r\n</style>","import MiniProgramPage from 'E:/program/FrontEnd/uni/detector/pages/history/history.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onShow","uni"],"mappings":";;;;;;;;;;;;;AAkCA,UAAM,cAAcA,cAAAA,IAAI,CAAA,CAAE;AAG1B,UAAM,aAAaA,cAAAA,IAAI;AAAA,MACrB,YAAY,CAAE;AAAA,MACd,QAAQ,CAAC;AAAA,QACP,MAAM;AAAA,QACN,MAAM,CAAE;AAAA,MACZ,CAAG;AAAA,MACD,OAAO;AAAA;AAAA,QAEL,WAAW;AAAA,UACT,MAAM;AAAA,QACP;AAAA;AAAA,QAED,UAAU;AAAA,UACR,MAAM;AAAA,QACP;AAAA;AAAA,QAED,UAAU;AAAA,UACR,MAAM;AAAA,QACP;AAAA,MACF;AAAA,IAEH,CAAC;AAGD,UAAM,UAAUA,cAAAA,IAAI;AAAA,MAClB,QAAQ,CAAC;AAAA,QACP,MAAM,CAAE;AAAA;AAAA,QAER,OAAO,CAAC,WAAW,iBAAiB,OAAO,KAAK;AAAA,MACpD,CAAG;AAAA,IACH,CAAC;AAEDC,kBAAAA,OAAO,MAAM;AACX;IACF,CAAC;AACD,UAAM,cAAc,MAAM;AACxB,kBAAY,QAAQC,cAAG,MAAC,eAAe,eAAe,KAAK,CAAA;AAG3D,iBAAW,QAAQ;AAAA,QACjB,YAAY,YAAY,MAAM,IAAI,UAAQ,GAAG;AAAA,QAC7C,QAAQ,CAAC;AAAA,UACP,GAAG,WAAW,MAAM,OAAO,CAAC;AAAA,UAC5B,MAAM,YAAY,MAAM,IAAI,UAAQ,OAAO,KAAK,MAAM,CAAC;AAAA,QAC7D,CAAK;AAAA,MACL;AAGE,YAAM,gBAAgB;AAAA,QACpB,OAAO,EAAE,KAAK,IAAI,KAAK,KAAK,OAAO,EAAG;AAAA,QACtC,OAAO,EAAE,KAAK,IAAI,KAAK,IAAI,OAAO,EAAG;AAAA,QACrC,OAAO,EAAE,KAAK,GAAG,KAAK,IAAI,OAAO,EAAG;AAAA,MACxC;AAEE,kBAAY,MAAM,QAAQ,UAAQ;AAChC,cAAM,SAAS,OAAO,KAAK,MAAM;AACjC,eAAO,OAAO,aAAa,EAAE,QAAQ,SAAO;AAC1C,cAAI,UAAU,IAAI,OAAO,UAAU,IAAI;AAAK,gBAAI;AAAA,QACtD,CAAK;AAAA,MACL,CAAG;AAED,cAAQ,QAAQ;AAAA,QACd,QAAQ,CAAC;AAAA,UACP,GAAG,QAAQ,MAAM,OAAO,CAAC;AAAA,UACzB,MAAM,OAAO,QAAQ,aAAa,EAAE,IAAI,CAAC,CAAC,MAAM,GAAG,OAAO;AAAA,YACxD;AAAA,YACA,OAAO,IAAI;AAAA,UACnB,EAAQ;AAAA,QACR,CAAK;AAAA,MACL;AAAA,IACA;AAIA,UAAM,mBAAmB,CAAC,WAAW;AACnC,YAAM,QAAQ,CAAC,GAAG,KAAK,CAAC;AACxB,YAAM,MAAM,CAAC,KAAK,GAAG,CAAC;AACtB,YAAM,IAAI,KAAK,MAAM,IAAI,CAAC,KAAK,SAAS,OAAO,MAAM,CAAC,KAAK,IAAI,SAAS,IAAI;AAC5E,YAAM,IAAI,KAAK,MAAM,IAAI,CAAC,KAAK,SAAS,OAAO,MAAM,CAAC,KAAK,IAAI,SAAS,IAAI;AAC5E,YAAM,IAAI,KAAK,MAAM,IAAI,CAAC,KAAK,SAAS,OAAO,MAAM,CAAC,KAAK,IAAI,SAAS,IAAI;AAC5E,YAAM,OAAO,KAAK,KAAK,KAAK,IAAI,GAAG,SAAS,EAAE,EAAE,SAAS,GAAG,GAAG;AAC/D,aAAO,IAAI,GAAG;AAAA,IAChB;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtHA,GAAG,WAAW,eAAe;"}