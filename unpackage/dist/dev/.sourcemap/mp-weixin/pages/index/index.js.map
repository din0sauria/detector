{"version":3,"file":"index.js","sources":["pages/index/index.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <!-- 概率显示区域 -->\r\n    <view class=\"progressBox\">\r\n      <ProgressCircleBar :size=\"300\" :percent=\"percent\" :progressColor=\"progressColor\" inner-color=\"#F8F9FA\"\r\n        :ball-size=\"45\"></ProgressCircleBar>\r\n    </view>\r\n    <!-- <text class=\"percent\" :style=\"{color: percent > 50 ? '#FF0000' : '#00FF00'}\">{{percent}}%</text> -->\r\n\r\n    <!-- 概率描述文本 -->\r\n    <view class=\"description\">音频伪造概率</view>\r\n\r\n    <!-- 文件描述文本 -->\r\n    <view class=\"file-name\">{{name}}</view>\r\n\r\n    <!-- 上传按钮 -->\r\n    <button class=\"upload-btn\" :disabled=\"loading\" :loading=\"loading\" @tap=\"handleUpload\">\r\n      {{ loading ? '上传检测中...' : '音频文件上传' }}\r\n    </button>\r\n\r\n    <view class=\"steps\">\r\n      <uni-steps :options=\"stepOptions\" :active=\"currentStateIndex\" active-color=\"#007AFF\"\r\n        direction=\"column\"></uni-steps>\r\n    </view>\r\n\r\n\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\n  import {\r\n    ref,\r\n    computed,\r\n    onUnmounted\r\n  } from 'vue'\r\n  import ProgressCircleBar from './ring.vue'\r\n  // 响应式数据\r\n  const percent = ref(0)\r\n  const loading = ref(false)\r\n  const name = ref('未上传文件')\r\n  let timer = null\r\n\r\n  const stepOptions = [{\r\n      title: '请选择音频文件'\r\n    },\r\n    {\r\n      title: '音频加密上传中'\r\n    },\r\n    {\r\n      title: '音频信号预处理中'\r\n    },\r\n    {\r\n      title: '加载深度伪造检测模型中'\r\n    },\r\n    {\r\n      title: '声学特征检测中'\r\n    },\r\n    {\r\n      title: '音频检测完成'\r\n    }\r\n  ]\r\n\r\n  let currentStateIndex = ref(0)\r\n\r\n  const startProgress = () => {\r\n    currentStateIndex.value = 0\r\n    timer = setInterval(() => {\r\n      if (currentStateIndex.value < stepOptions.length - 2) {\r\n        currentStateIndex.value++\r\n      }\r\n    }, 3000)\r\n  }\r\n\r\n  const stopProgress = () => {\r\n    clearInterval(timer)\r\n    currentStateIndex.value = stepOptions.length - 1\r\n  }\r\n\r\n  onUnmounted(() => {\r\n    clearInterval(timer)\r\n  })\r\n\r\n  // 根据百分比计算颜色\r\n  const progressColor = computed(() => {\r\n    // 绿色（0%）的 RGB 值\r\n    const green = [0, 255, 0];\r\n    // 红色（100%）的 RGB 值\r\n    const red = [255, 0, 0];\r\n\r\n    // 根据百分比计算 RGB 值\r\n    const r = Math.round(red[0] * (percent.value / 100) + green[0] * (1 - percent.value / 100));\r\n    const g = Math.round(red[1] * (percent.value / 100) + green[1] * (1 - percent.value / 100));\r\n    const b = Math.round(red[2] * (percent.value / 100) + green[2] * (1 - percent.value / 100));\r\n\r\n    // 将 RGB 转换为十六进制颜色\r\n    const hex = ((r << 16) | (g << 8) | b).toString(16).padStart(6, '0');\r\n    if (percent.value < 45) {\r\n      return ['#72d555', `#${hex}`]\r\n    } else {\r\n      return ['#72d555', `#FFA500`, `#${hex}`]\r\n    }\r\n  })\r\n  // 处理文件上传\r\n  const handleUpload = async () => {\r\n    try {\r\n      // 文件选择\r\n      const res = await uni.chooseMessageFile({\r\n        count: 1,\r\n        type: 'file',\r\n        extension: ['wav', 'mp3', 'm4a','flac','aac']\r\n      })\r\n\r\n      if (!res?.tempFiles?.[0]) return\r\n\r\n      name.value = res.tempFiles[0].name\r\n      loading.value = true\r\n      startProgress()\r\n\r\n      console.log(res.tempFiles[0].path)\r\n\r\n      // 文件上传\r\n      uni.uploadFile({\r\n        url: 'https://whusafeear.top:3006/common/upload',\r\n        filePath: res.tempFiles[0].path,\r\n        name: 'file',\r\n        header: {\r\n          // 'Transfer-Encoding':'chunked'\r\n        },\r\n        formData: {\r\n          'content-type': 'multipart/form-data'\r\n        },\r\n        success: (uploadRes) => {\r\n          try {\r\n            const data = JSON.parse(uploadRes.data)\r\n            percent.value = Number((parseFloat(data.probability) * 100).toFixed(2))\r\n\r\n            // 新增：保存到历史记录\r\n            saveHistory({\r\n              fileName: name.value,\r\n              source: '文件上传',\r\n              result: percent.value,\r\n              time: new Date().toLocaleString()\r\n            })\r\n          } catch (e) {\r\n            uni.showToast({\r\n              title: e,\r\n              icon: 'error',\r\n              duration: 2000\r\n            })\r\n          }\r\n        },\r\n        fail: (err) => {\r\n          uni.showToast({\r\n            title: '上传失败',\r\n            icon: 'error'\r\n          })\r\n          console.error('上传失败:', err)\r\n        },\r\n        complete: () => {\r\n          loading.value = false\r\n          stopProgress()\r\n        }\r\n      })\r\n    } catch (err) {\r\n      console.error('文件选择错误:', err)\r\n      uni.showToast({\r\n        title: '文件选择失败',\r\n        icon: 'error'\r\n      })\r\n      stopProgress()\r\n    }\r\n  }\r\n\r\n  // 跳转到录音页面\r\n  const goToRecord = () => {\r\n    uni.switchTab({\r\n      url: '/pages/record/record'\r\n    })\r\n  }\r\n\r\n  // 新增：保存历史记录方法\r\n  const saveHistory = (data) => {\r\n    let history = uni.getStorageSync('detectHistory') || []\r\n    history.unshift(data)\r\n    if (history.length > 50) history = history.slice(0, 50)\r\n    uni.setStorageSync('detectHistory', history)\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n  .container {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    height: 100vh;\r\n    padding: 30rpx;\r\n  }\r\n\r\n  .progressBox {\r\n    position: relative;\r\n    width: 300rpx;\r\n    height: 300rpx;\r\n    margin: 0 auto;\r\n    margin: 30rpx;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n  }\r\n\r\n  .description {\r\n    font-size: 40rpx;\r\n    margin: 30rpx;\r\n  }\r\n\r\n  .file-name {\r\n    font-size: 28rpx;\r\n    margin: 30rpx;\r\n  }\r\n\r\n  button {\r\n    width: 60%;\r\n    height: 100rpx;\r\n    line-height: 100rpx;\r\n    border-radius: 50rpx;\r\n    font-size: 36rpx;\r\n    margin-top: 30rpx;\r\n  }\r\n\r\n  .upload-btn {\r\n    background-color: #007AFF;\r\n    color: white;\r\n  }\r\n\r\n  .upload-btn[disabled] {\r\n    background-color: #CCCCCC;\r\n  }\r\n\r\n  .record-btn {\r\n    background-color: #34C759;\r\n    color: white;\r\n    margin-top: 100rpx;\r\n  }\r\n\r\n  .steps {\r\n    margin-top: 30rpx;\r\n    width: 60%;\r\n\r\n  }\r\n</style>","import MiniProgramPage from 'E:/program/FrontEnd/uni/detector/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onUnmounted","computed","uni"],"mappings":"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"}