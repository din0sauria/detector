{"version":3,"names":["historyList","common_vendor","ref","columnData","categories","series","name","data","color","params","getColorByResult","value","dataIndex","result","green","red","r","Math","round","g","b","hex","toString","padStart","concat","wx","createPage","MiniProgramPage"],"sources":["history.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaGlzdG9yeS9oaXN0b3J5LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <view class=\"header\">\r\n      <text class=\"title\">检测历史记录</text>\r\n      <text class=\"subtitle\">最近50条记录</text>\r\n    </view>\r\n\r\n<qiun-data-charts \r\n  type=\"column\" \r\n  :chartData=\"chartData.column\"\r\n  class=\"chart\"\r\n/>\r\n<qiun-data-charts\r\n  type=\"pie\"\r\n  :chartData=\"chartData.pie\" \r\n  class=\"chart\"\r\n/>\r\n    <scroll-view class=\"history-list\" scroll-y>\r\n      <view \r\n        v-for=\"(item, index) in historyList\" \r\n        :key=\"index\" \r\n        class=\"history-item\"\r\n        :style=\"{borderLeftColor: getColorByResult(item.result)}\"\r\n      >\r\n        <view class=\"item-header\">\r\n          <text class=\"file-name\">{{ item.fileName }}</text>\r\n          <text class=\"result\" :style=\"{color: getColorByResult(item.result)}\">\r\n            {{ item.result }}%\r\n          </text>\r\n        </view>\r\n        <view class=\"item-footer\">\r\n          <text class=\"source\">{{ item.source }}</text>\r\n          <text class=\"time\">{{ item.time }}</text>\r\n        </view>\r\n      </view>\r\n    </scroll-view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\nimport { onShow, onReady } from '@dcloudio/uni-app'\r\n\r\nconst historyList = ref([]);\r\n\r\n// 柱状图数据（按官方文档结构）\r\nconst columnData = ref({\r\n  categories: [],\r\n  series: [{\r\n    name: \"检测结果\",\r\n    data: [],\r\n    color: (params) => { // 颜色配置直接放在series中\r\n      return getColorByResult(columnData.value.series[0].data[params.dataIndex])\r\n    }\r\n  }]\r\n});\r\n\r\n// 饼图数据（按官方文档结构）\r\nconst pieData = ref({\r\n  series: [{\r\n    data: [],\r\n    // 饼图颜色配置\r\n    color: (params) => getColorByResult(params.value)\r\n  }]\r\n});\r\n\r\nconst loadHistory = () => {\r\n  historyList.value = uni.getStorageSync('detectHistory') || [];\r\n  \r\n  // 更新柱状图数据\r\n  columnData.value = {\r\n    categories: historyList.value.map(item => item.fileName),\r\n    series: [{\r\n      ...columnData.value.series[0],\r\n      data: historyList.value.map(item => Number(item.result))\r\n    }]\r\n  };\r\n\r\n  // 更新饼图数据（保持分类逻辑）\r\n  const pieCategories = {\r\n    '高风险': { min: 70, max: 100, count: 0 },\r\n    '中风险': { min: 30, max: 69, count: 0 },\r\n    '低风险': { min: 0, max: 29, count: 0 }\r\n  };\r\n  \r\n  historyList.value.forEach(item => {\r\n    const result = Number(item.result);\r\n    Object.values(pieCategories).forEach(cat => {\r\n      if (result >= cat.min && result <= cat.max) cat.count++;\r\n    });\r\n  });\r\n\r\n  pieData.value = {\r\n    series: [{\r\n      ...pieData.value.series[0],\r\n      data: Object.entries(pieCategories).map(([name, cat]) => ({\r\n        name,\r\n        value: cat.count\r\n      }))\r\n    }]\r\n  };\r\n};\r\n\r\n\r\n\r\nconst getColorByResult = (result) => {\r\n  const green = [0, 255, 0];\r\n  const red = [255, 0, 0];\r\n  const r = Math.round(red[0] * (result / 100) + green[0] * (1 - result / 100));\r\n  const g = Math.round(red[1] * (result / 100) + green[1] * (1 - result / 100));\r\n  const b = Math.round(red[2] * (result / 100) + green[2] * (1 - result / 100));\r\n  const hex = (r << 16 | g << 8 | b).toString(16).padStart(6, '0');\r\n  return `#${hex}`;\r\n};\r\n\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.container {\r\n  padding: 20rpx;\r\n  height: 100vh;\r\n  background-color: #f5f5f5;\r\n}\r\n\r\n.header {\r\n  padding: 20rpx;\r\n  margin-bottom: 20rpx;\r\n  \r\n  .title {\r\n    font-size: 40rpx;\r\n    font-weight: bold;\r\n    display: block;\r\n  }\r\n  \r\n  .subtitle {\r\n    font-size: 28rpx;\r\n    color: #666;\r\n  }\r\n}\r\n\r\n.history-list {\r\n  height: calc(100vh - 120rpx);\r\n}\r\n\r\n.history-item {\r\n  background: #fff;\r\n  border-radius: 12rpx;\r\n  padding: 20rpx;\r\n  margin-bottom: 20rpx;\r\n  border-left: 8rpx solid;\r\n  \r\n  .item-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    margin-bottom: 10rpx;\r\n    \r\n    .file-name {\r\n      font-size: 32rpx;\r\n      max-width: 70%;\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n      white-space: nowrap;\r\n    }\r\n    \r\n    .result {\r\n      font-size: 32rpx;\r\n      font-weight: bold;\r\n    }\r\n  }\r\n  \r\n  .item-footer {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    font-size: 24rpx;\r\n    color: #999;\r\n  }\r\n}\r\n\r\n.chart {\r\n  width: 100%;\r\n  height: 300rpx;\r\n  margin-bottom: 20rpx;\r\n}\r\n</style>","import MiniProgramPage from 'E:/program/FrontEnd/uni/detector/pages/history/history.vue'\nwx.createPage(MiniProgramPage)"],"mappings":";;;;;;;;;;;;;;;;;IA2CA,IAAMA,WAAA,GAAcC,aAAA,CAAAC,GAAA,CAAI,EAAE;IAG1B,IAAMC,UAAA,GAAaF,aAAA,CAAAC,GAAA,CAAI;MACrBE,UAAA,EAAY,EAAE;MACdC,MAAA,EAAQ,CAAC;QACPC,IAAA,EAAM;QACNC,IAAA,EAAM,EAAE;QACRC,KAAA,EAAO,SAAPA,MAAQC,MAAA,EAAW;UACjB,OAAOC,gBAAA,CAAiBP,UAAA,CAAWQ,KAAA,CAAMN,MAAA,CAAO,CAAC,EAAEE,IAAA,CAAKE,MAAA,CAAOG,SAAS,CAAC;QAC1E;MACL,CAAG;IACH,CAAC;IAGeX,aAAA,CAAAC,GAAA,CAAI;MAClBG,MAAA,EAAQ,CAAC;QACPE,IAAA,EAAM,EAAE;QAAA;QAERC,KAAA,EAAO,SAAPA,MAAQC,MAAA;UAAA,OAAWC,gBAAA,CAAiBD,MAAA,CAAOE,KAAK;QAAA;MACpD,CAAG;IACH,CAAC;IAyCD,IAAMD,gBAAA,GAAmB,SAAnBA,iBAAoBG,MAAA,EAAW;MACnC,IAAMC,KAAA,GAAQ,CAAC,GAAG,KAAK,CAAC;MACxB,IAAMC,GAAA,GAAM,CAAC,KAAK,GAAG,CAAC;MACtB,IAAMC,CAAA,GAAIC,IAAA,CAAKC,KAAA,CAAMH,GAAA,CAAI,CAAC,KAAKF,MAAA,GAAS,OAAOC,KAAA,CAAM,CAAC,KAAK,IAAID,MAAA,GAAS,IAAI;MAC5E,IAAMM,CAAA,GAAIF,IAAA,CAAKC,KAAA,CAAMH,GAAA,CAAI,CAAC,KAAKF,MAAA,GAAS,OAAOC,KAAA,CAAM,CAAC,KAAK,IAAID,MAAA,GAAS,IAAI;MAC5E,IAAMO,CAAA,GAAIH,IAAA,CAAKC,KAAA,CAAMH,GAAA,CAAI,CAAC,KAAKF,MAAA,GAAS,OAAOC,KAAA,CAAM,CAAC,KAAK,IAAID,MAAA,GAAS,IAAI;MAC5E,IAAMQ,GAAA,IAAOL,CAAA,IAAK,KAAKG,CAAA,IAAK,IAAIC,CAAA,EAAGE,QAAA,CAAS,EAAE,EAAEC,QAAA,CAAS,GAAG,GAAG;MAC/D,WAAAC,MAAA,CAAWH,GAAG;IAChB;;;;;;;;;;;;;;;;;;;;;;;;;;;AChHAI,EAAA,CAAGC,UAAA,CAAWC,eAAe","ignoreList":[]}